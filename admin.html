<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PowerMax Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  padding:20px;
}
h1{
  text-align:center;
  margin-bottom:20px;
}
.section{
  background:#020617;
  border-radius:12px;
  padding:16px;
  margin-bottom:20px;
}
.item{
  background:#111827;
  border-radius:10px;
  padding:12px;
  margin-bottom:10px;
  font-size:14px;
}
button{
  padding:8px 14px;
  border:none;
  border-radius:20px;
  cursor:pointer;
  font-weight:600;
}
.approve{background:#22c55e;color:#000}
.reject{background:#ef4444;color:#fff}
.logout{
  background:#f97316;
  width:100%;
  margin-top:20px;
}
</style>
</head>

<body>

<h1>âš¡ PowerMax Admin Panel</h1>

<div class="section">
  <h3>ðŸ’° Deposit Requests</h3>
  <div id="depositList">Loading...</div>
</div>

<div class="section">
  <h3>ðŸ’¸ Withdraw Requests</h3>
  <div id="withdrawList">Loading...</div>
</div>

<button class="logout" onclick="logout()">Logout</button>

<script type="module">
/* =========================
   1ï¸âƒ£ IMPORTS
========================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
  getFirestore,
  collection,
  getDocs,
  updateDoc,
  doc,
  increment
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* =========================
   2ï¸âƒ£ FIREBASE CONFIG
========================= */
const firebaseConfig = {
  apiKey: "AIzaSyCzHxyLgn9ZKRwD1X0RuUSq3od6MWizieg",
  authDomain: "powermax-fe149.firebaseapp.com",
  projectId: "powermax-fe149"
};

/* =========================
   3ï¸âƒ£ ADMIN EMAIL
========================= */
const ADMIN_EMAIL = "blochakhtar28@gmail.com";

/* =========================
   4ï¸âƒ£ INIT
========================= */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* =========================
   5ï¸âƒ£ LOGIN GUARD
========================= */
onAuthStateChanged(auth, (user)=>{
  if(!user || user.email !== ADMIN_EMAIL){
    window.location.replace("admin-login.html");
    return;
  }

  // âœ… ADMIN VERIFIED
  loadDeposits();
  loadWithdraws();
});

/* =========================
   6ï¸âƒ£ DEPOSITS
========================= */
async function loadDeposits(){
  const box = document.getElementById("depositList");
  box.innerHTML = "";

  const snap = await getDocs(collection(db,"deposits"));
  if(snap.empty){
    box.innerHTML = "No deposit requests.";
    return;
  }

  snap.forEach(d=>{
    const data = d.data();
    box.innerHTML += `
      <div class="item">
        <b>User:</b> ${data.uid}<br>
        <b>Amount:</b> ${data.amount} PTS<br><br>
        <button class="approve"
          onclick="approveDeposit('${d.id}','${data.uid}',${data.amount})">
          Approve
        </button>
        <button class="reject"
          onclick="reject('deposits','${d.id}')">
          Reject
        </button>
      </div>
    `;
  });
}

/* =========================
   7ï¸âƒ£ WITHDRAWS
========================= */
async function loadWithdraws(){
  const box = document.getElementById("withdrawList");
  box.innerHTML = "";

  const snap = await getDocs(collection(db,"withdraws"));
  if(snap.empty){
    box.innerHTML = "No withdraw requests.";
    return;
  }

  snap.forEach(d=>{
    const data = d.data();
    box.innerHTML += `
      <div class="item">
        <b>User:</b> ${data.uid}<br>
        <b>Amount:</b> ${data.amount} PTS<br><br>
        <button class="approve"
          onclick="approveWithdraw('${d.id}')">
          Approve
        </button>
        <button class="reject"
          onclick="reject('withdraws','${d.id}')">
          Reject
        </button>
      </div>
    `;
  });
}

/* =========================
   8ï¸âƒ£ ACTIONS
========================= */
window.approveDeposit = async (id, uid, amount)=>{
  await updateDoc(doc(db,"users",uid),{
    balance: increment(amount)
  });
  await updateDoc(doc(db,"deposits",id),{status:"approved"});
  location.reload();
};

window.approveWithdraw = async (id)=>{
  await updateDoc(doc(db,"withdraws",id),{status:"approved"});
  location.reload();
};

window.reject = async (col,id)=>{
  await updateDoc(doc(db,col,id),{status:"rejected"});
  location.reload();
};

window.logout = async ()=>{
  await signOut(auth);
  window.location.href = "admin-login.html";
};
</script>

</body>
</html>
