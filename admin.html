<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PowerMax Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  padding:20px;
}
h1{text-align:center;margin-bottom:20px}
.section{
  background:#020617;
  border-radius:12px;
  padding:16px;
  margin-bottom:20px;
}
.item{
  background:#111827;
  border-radius:10px;
  padding:12px;
  margin-bottom:10px;
  font-size:14px;
}
button{
  padding:8px 14px;
  border:none;
  border-radius:20px;
  cursor:pointer;
  font-weight:600;
}
.approve{background:#22c55e;color:#000}
.reject{background:#ef4444;color:#fff}
.logout{background:#f97316;width:100%;margin-top:20px}
</style>
</head>

<body>

<h1>‚ö° PowerMax Admin Panel</h1>

<div class="section">
  <h3>üí∞ Deposit Requests</h3>
  <input
  type="text"
  id="depositSearch"
  placeholder="Search by Wallet Number"
  oninput="loadDeposits()"
  style="
    width:100%;
    padding:10px;
    margin-bottom:12px;
    border-radius:8px;
    border:none;
  "
>
  <div id="depositList">Loading...</div>
</div>

<button class="logout" onclick="logout()">Logout</button>

<script type="module">
/* ---------- FIREBASE ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getAuth,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
  getFirestore,
  collection,
  getDocs,
  updateDoc,
  doc,
  increment
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCzHxyLgn9ZKRwD1X0RuUSq3od6MWizieg",
  authDomain: "powermax-fe149.firebaseapp.com",
  projectId: "powermax-fe149"
};

const ADMIN_EMAIL = "blochakhtar28@gmail.com";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ---------- AUTH CHECK ---------- */
onAuthStateChanged(auth, (user)=>{
  if(!user || user.email !== ADMIN_EMAIL){
    location.replace("admin-login.html");
    return;
  }
  loadDeposits();
});

/* ---------- LOAD DEPOSITS ---------- */
async function loadDeposits(){
  const box = document.getElementById("depositList");
  box.innerHTML = "";
  const searchValue = document
  .getElementById("depositSearch")
  .value
  .trim();

  const snap = await getDocs(collection(db,"deposits"));

  if(snap.empty){
    box.innerHTML = "No deposit requests.";
    return;
  }

  snap.forEach(d=>{
    const data = d.data();
    // üîç FILTER BY WALLET NUMBER
if (searchValue && !String(data.senderNumber).includes(searchValue)) {
  return;
}
    if(data.status !== "pending") return;

    box.innerHTML += `
      <div class="item" id="dep-${d.id}">
        <b>User ID:</b> ${data.uid}<br>
        <b>Wallet Owner Name:</b> ${data.senderName}<br>
        <b>Wallet Number:</b> ${data.senderNumber}<br>
        <b>Amount:</b> ${data.amount} PTS<br><br>

        <button class="approve"
          onclick="approveDeposit('${d.id}','${data.uid}',${data.amount})">
          Approve
        </button>

        <button class="reject"
          onclick="rejectDeposit('${d.id}')">
          Reject
        </button>
      </div>
    `;
  });
}

/* ---------- APPROVE ---------- */
window.approveDeposit = async (id, uid, amount)=>{
  await updateDoc(doc(db,"users",uid),{
    balance: increment(amount)
  });

  await updateDoc(doc(db,"deposits",id),{
    status:"approved"
  });

  document.getElementById("dep-"+id).remove();
};

/* ---------- REJECT ---------- */
window.rejectDeposit = async (id)=>{
  await updateDoc(doc(db,"deposits",id),{
    status:"rejected"
  });

  document.getElementById("dep-"+id).remove();
};

/* ---------- LOGOUT ---------- */
window.logout = async ()=>{
  await signOut(auth);
  location.replace("admin-login.html");
};
</script>

</body>
</html>
