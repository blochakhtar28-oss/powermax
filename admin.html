 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>‚ö° PowerMax Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial,sans-serif;
  background:#f4f6f8;
  padding:20px
}
h2{margin-bottom:6px}
.box{
  background:#fff;
  padding:16px;
  border-radius:10px;
  margin-bottom:20px;
  box-shadow:0 2px 8px rgba(0,0,0,.08)
}
.plan{
  display:flex;
  gap:8px;
  align-items:center;
  margin-bottom:8px;
  flex-wrap:wrap
}
input{
  padding:6px;
  width:90px
}
button{
  padding:6px 12px;
  cursor:pointer
}
.save{background:#2ecc71;color:#fff;border:none}
</style>
</head>

<body>

<h2>‚ö° PowerMax Admin Panel</h2>
<p>Only website owner can access</p>

<div class="box">
  <h3>üì• Deposit Requests</h3>
  <div id="depositList">Loading...</div>
</div>

<div class="box">
  <h3>üì§ Withdraw Requests</h3>
  <div id="withdrawList">Loading...</div>
</div>

<div class="box">
  <h3>‚öôÔ∏è Global Settings</h3>
  <div id="settingsBox">Loading...</div>
</div>

<div class="box">
  <h3>üì¶ Plans & Commission Manager</h3>
  <div id="plansBox">Loading...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  updateDoc,
  collection,
  getDocs
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

import {
  getFirestore,
  doc,
  getDoc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCzHxyLgn9ZKRwD1X0RuUSq3od6MWizieg",
  authDomain: "powermax-fe149.firebaseapp.com",
  projectId: "powermax-fe149"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* üîí ADMIN CHECK */
async function isAdmin(uid){
  const ref = doc(db,"admins",uid);
  const snap = await getDoc(ref);
  return snap.exists() && snap.data().role === "admin";
}

/* üîê AUTH */
onAuthStateChanged(auth, async(user)=>{
  if(!user){
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth,provider);
    return;
  }

  const admin = await isAdmin(user.uid);
  if(!admin){
    alert("Access denied");
    location.href="dashboard.html";
    return;
  }

  loadGlobalSettings();
  loadWithdrawRequests();
});

/* ‚öôÔ∏è LOAD SETTINGS + PLANS */
async function loadGlobalSettings(){
  const ref = doc(db,"settings","global");
  const snap = await getDoc(ref);

  if(!snap.exists()){
    alert("Global settings missing");
    return;
  }

  const data = snap.data();

  document.getElementById("settingsBox").innerHTML = `
    Min Withdraw: <b>${data.minWithdraw}</b><br>
    Plan Expiry Days: <b>${data.planExpiryDays}</b>
  `;

  loadPlans(data.plans);
}

/* üì¶ PLANS MANAGER */
function loadPlans(plans){
  const box = document.getElementById("plansBox");
  box.innerHTML = "";

  Object.keys(plans).forEach(key=>{
    const p = plans[key];

    box.innerHTML += `
      <div class="plan">
        <b>${key}</b>
        Price:
        <input id="price_${key}" value="${p.price}">
        Commission %:
        <input id="com_${key}" value="${p.commission}">
        <button class="save" onclick="savePlan('${key}')">Save</button>
      </div>
    `;
  });
}

/* üíæ SAVE PLAN */
window.savePlan = async (key)=>{
  const price = Number(document.getElementById("price_"+key).value);
  const com = Number(document.getElementById("com_"+key).value);

  const ref = doc(db,"settings","global");

  await updateDoc(ref,{
    [`plans.${key}.price`]: price,
    [`plans.${key}.commission`]: com
  });

  alert(key+" updated successfully");
};
async function loadWithdrawRequests(){
  const box = document.getElementById("withdrawList");
  box.innerHTML = "Loading...";

  const snap = await getDocs(collection(db,"withdrawRequests"));

  if(snap.empty){
    box.innerHTML = "No withdrawal requests";
    return;
  }

  box.innerHTML = "";

  snap.forEach(d=>{
    const w = d.data();

    box.innerHTML += `
      <div style="margin-bottom:8px;">
        <b>${w.email}</b><br>
        Amount: ${w.amount}<br>
        Status: ${w.status}
      </div>
      <hr>
    `;
  });
}
loadWithdrawRequests();
</script>

</body>
  </html>
