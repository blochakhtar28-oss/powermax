<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PowerMax Admin Panel</title>
  <style>
    body { font-family: Arial; background:#111; color:#fff; padding:20px }
    button { padding:6px 12px; margin:4px; cursor:pointer }
    .box { border:1px solid #333; padding:10px; margin-bottom:10px }
  </style>
</head>
<body>

<h2>ğŸ” Admin Panel</h2>
<button onclick="login()">Sign in with Google</button>
<button onclick="logout()">Logout</button>

<hr>

<h3>ğŸ’° Deposit Requests</h3>
<div id="depositList">Loading...</div>

<hr>

<h3>ğŸ§ Withdraw Requests</h3>
<div id="withdrawList">Loading...</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, getDocs, doc,
  getDoc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import {
  getAuth, GoogleAuthProvider,
  signInWithPopup, signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

let currentAdmin = null;

/* ğŸ” LOGIN */
window.login = async ()=>{
  const res = await signInWithPopup(auth, provider);
  const user = res.user;

  const snap = await getDoc(doc(db,"admins",user.uid));
  if(!snap.exists()){
    alert("Not admin");
    await signOut(auth);
    return;
  }

  currentAdmin = user;
  loadDeposits();
  loadWithdraws();
};

/* ğŸšª LOGOUT */
window.logout = async ()=>{
  await signOut(auth);
  location.reload();
};

/* ğŸ’° LOAD DEPOSITS */
async function loadDeposits(){
  const box = document.getElementById("depositList");
  box.innerHTML = "Loading...";

  const snap = await getDocs(collection(db,"depositRequests"));
  box.innerHTML = "";

  snap.forEach(d=>{
    const w = d.data();
    if(w.status !== "pending") return;

    box.innerHTML += `
      <div class="box">
        <b>${w.email}</b><br>
        Amount: ${w.amount}<br>
        TRX: ${w.trx}<br>
        <button onclick="approveDeposit('${d.id}','${w.uid}',${w.amount})">Approve</button>
        <button onclick="rejectDeposit('${d.id}')">Reject</button>
      </div>
    `;
  });
}

/* âœ… APPROVE DEPOSIT */
window.approveDeposit = async (id, uid, amount)=>{
  await updateDoc(doc(db,"depositRequests",id),{
    status:"approved"
  });

  const uref = doc(db,"users",uid);
  const usnap = await getDoc(uref);
  const bal = usnap.data().balance || 0;

  await updateDoc(uref,{
    balance: bal + amount
  });

  loadDeposits();
};

/* âŒ REJECT DEPOSIT */
window.rejectDeposit = async (id)=>{
  await updateDoc(doc(db,"depositRequests",id),{
    status:"rejected"
  });
  loadDeposits();
};

/* ğŸ§ LOAD WITHDRAW */
async function loadWithdraws(){
  const box = document.getElementById("withdrawList");
  box.innerHTML = "Loading...";

  const snap = await getDocs(collection(db,"withdrawRequests"));
  box.innerHTML = "";

  snap.forEach(d=>{
    const w = d.data();
    if(w.status !== "pending") return;

    box.innerHTML += `
      <div class="box">
        <b>${w.email}</b><br>
        Amount: ${w.amount}<br>
        <button onclick="approveWithdraw('${d.id}')">Approve</button>
        <button onclick="rejectWithdraw('${d.id}')">Reject</button>
      </div>
    `;
  });
}

window.approveWithdraw = async (id)=>{
  await updateDoc(doc(db,"withdrawRequests",id),{
    status:"approved"
  });
  loadWithdraws();
};

window.rejectWithdraw = async (id)=>{
  await updateDoc(doc(db,"withdrawRequests",id),{
    status:"rejected"
  });
  loadWithdraws();
};
</script>

</body>
 </html>
